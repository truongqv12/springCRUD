<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>AdminLTE 2 | Blank Page</title>
    <!-- Tell the browser to be responsive to screen width -->
    <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
    <!-- Bootstrap 3.3.7 -->
    <link rel="stylesheet" th:href="@{/css/bootstrap.min.css}">

    <link rel="stylesheet" th:href="@{/css/font-awesome.min.css}">

    <link rel="stylesheet" th:href="@{/css/AdminLTE.min.css}">

    <link rel="stylesheet" th:href="@{/css/_all-skins.min.css}">

    <link rel="stylesheet" th:href="@{/css/jquery-ui.css}">

    <link rel="stylesheet" th:href="@{/css/toastr.min.css}"/>

    <link rel="stylesheet" th:href="@{/css/waitMe.min.css}"/>

    <link rel="stylesheet" th:href="@{/css/style.css}"/>

</head>
<body class="hold-transition skin-blue sidebar-mini">
<!-- Site wrapper -->
<div class="wrapper">

    <header class="main-header">
        <!-- Logo -->
        <a href="/" class="logo">
            <!-- mini logo for sidebar mini 50x50 pixels -->
            <span class="logo-mini"><b>A</b>LT</span>
            <!-- logo for regular state and mobile devices -->
            <span class="logo-lg"><b>Admin</b>LTE</span>
        </a>
        <!-- Header Navbar: style can be found in header.less -->
        <nav class="navbar navbar-static-top">
            <!-- Sidebar toggle button-->
            <a href="#" class="sidebar-toggle" data-toggle="push-menu" role="button">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </a>

            <div class="navbar-custom-menu">
                <ul class="nav navbar-nav">
                    <!-- User Account: style can be found in dropdown.less -->
                    <li class="dropdown user user-menu">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                            <img src="/images/avatar.png" class="user-image" alt="User Image">
                            <span class="hidden-xs">Trần Trọng Trường</span>
                        </a>
                    </li>

                </ul>
            </div>
        </nav>
    </header>

    <aside class="main-sidebar">
        <!-- sidebar: style can be found in sidebar.less -->
        <section class="sidebar">
            <!-- Sidebar user panel -->
            <div class="user-panel">
                <div class="pull-left image">
                    <img src="/images/avatar.png" class="img-circle" alt="User Image">
                </div>
                <div class="pull-left info">
                    <p>Trường</p>
                    <a href="#"><i class="fa fa-circle text-success"></i> Online</a>
                </div>
            </div>
            <!-- sidebar menu: : style can be found in sidebar.less -->
            <ul class="sidebar-menu" data-widget="tree">
                <li><a th:href="@{employee}"><i class="fa fa-users"></i> <span>Employee</span></a></li>
            </ul>
        </section>
        <!-- /.sidebar -->
    </aside>

    <!-- =============================================== -->

    <!-- Content Wrapper. Contains page content -->
    <div class="content-wrapper">
        <ol class="breadcrumb no-margin">
            <li><a th:href="@{/index.html}"><i class="fa fa-dashboard"></i> Home</a></li>
            <li class="active">Employee</li>
        </ol>

        <!-- Main content -->
        <section class="content">
            <div class="row">
                <div class="col-xs-12">
                    <div class="box">
                        <div class="box-header">
                            <h3 class="box-title">Danh sách nhân viên</h3>
                        </div>
                        <div class="box-body">
                            <!-- /.box-header -->
                            <div class="div">
                                <div class="row">
                                    <div class="col-xs-4">
                                        <div class="form-group">
                                            <label>Tiêu đề</label>
                                            <input name="address" value="" class="form-control"
                                                   placeholder="Nhập tiêu đề">
                                        </div>
                                    </div>
                                    <div class="col-xs-3">
                                        <div class="form-group">
                                            <label>Chức vụ</label>
                                            <select name="status" id="show_job" class="form-control">
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-xs-2">
                                        <div class="form-group">
                                            <label>&nbsp;</label>
                                            <input class="form-control btn btn-primary" type="submit" value="Tìm kiếm">
                                        </div>
                                    </div>
                                    <div class="col-xs-2">
                                        <div class="form-group">
                                            <label>&nbsp;</label>
                                            <a class="form-control btn btn-success" data-toggle="modal"
                                               href='#modal-id'>Thêm mới</a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <table id="data_table" class="table table-bordered table-striped">
                                <thead>
                                <tr>
                                    <th class="bg-primary">ID</th>
                                    <th class="bg-primary" width="300px">Họ tên</th>
                                    <th class="bg-primary">Chức vụ</th>
                                    <th class="bg-primary">Số điện thoại</th>
                                    <th class="bg-primary" width="300px">Địa chỉ</th>
                                    <th class="bg-primary">Hành động</th>
                                </tr>
                                </thead>
                                <tbody id="show_data">

                                </tbody>
                            </table>
                        </div>
                        <!-- /.box-body -->
                        <div class="box-footer clearfix" id="paginate_div">

                        </div>
                    </div>
                    <!-- /.box -->
                </div>
                <!-- /.col -->
            </div>
            <!-- /.row -->
        </section>
        <!-- /.content -->
    </div>
    <!-- /.content-wrapper -->
    
    <footer class="main-footer">
        <div class="pull-right hidden-xs">
            <b>Version</b> 2.4.0
        </div>
        <strong>Copyright &copy; 2014-2016 <a href="https://adminlte.io">Almsaeed Studio</a>.</strong> All rights
        reserved.
    </footer>
    <div class="modal fade" id="modal-id">
        <div class="modal-dialog">
            <div class="modal-content">
                <form class="form-horizontal" name="form_add_employee" id="form_add_employee" enctype="multipart/form-data">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"
                                aria-hidden="true">&times;
                        </button>
                        <h4 class="modal-title">Thêm mới nhân viên</h4>
                    </div>
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Họ và tên</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="emp_name" placeholder="Nhập họ tên">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Email</label>
                            <div class="col-sm-9">
                                <input type="email" class="form-control" name="emp_email" placeholder="Nhập email">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">SĐT</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="emp_phone" placeholder="Nhập số điện thoại">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Địa chỉ</label>
                            <div class="col-sm-9">
                                <input type="text" class="form-control" name="emp_address" placeholder="Nhập địa chỉ">
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Chức vụ</label>
                            <div class="col-sm-9">
                                <select class="form-control" id="job_select_content" name="job_id"></select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Ngày nhận việc</label>
                            <div class="col-sm-9">
                                <input type="date" class="form-control" name="hire_date" value="">
                            </div>
                        </div>

                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default"
                                data-dismiss="modal">Close
                        </button>
                        <button type="button" class="btn btn-primary" onclick="submit_ajax_add_employ(this)">Lưu</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<!-- ./wrapper -->

<!-- jQuery 3 -->

<script th:src="@{/js/jquery.min.js}"></script>

<script th:src="@{/js/jquery-ui.js}"></script>

<script th:src="@{/js/bootstrap.min.js}"></script>

<script th:src="@{/js/adminlte.min.js}"></script>

<script th:src="@{/js/dashboard.js}"></script>

<script th:src="@{/js/toastr.min.js}"></script>

<script th:src="@{/js/waitMe.min.js}"></script>

<script th:src="@{/js/function.js}"></script>

<script>
    $(document).ready(function () {
        //lấy dữ liệu
        getEmloyee();
        getAllJob();
    });

    $.fn.serializeObject = function() {
        var o = {};
        var a = this.serializeArray();
        $.each(a, function() {
            if (o[this.name]) {
                if (!o[this.name].push) {
                    o[this.name] = [o[this.name]];
                }
                o[this.name].push(this.value || '');
            } else {
                o[this.name] = this.value || '';
            }
        });
        return o;
    };

    function submit_ajax_add_employ(ele) {
        var form = $(ele).parents('form');
        var emp_name = form.find('input[name=emp_name]').val();
        var emp_phone = form.find('input[name=emp_phone]').val();
        var emp_address = form.find('input[name=emp_address]').val();
        var hire_date = form.find('input[name=hire_date]').val();
        var emp_email = form.find('input[name=emp_email]').val();
        var job_id = form.find('select[name=job_id]').val();

        if (emp_name === '' || hire_date === '' || emp_email === '' || emp_phone === ''|| job_id === '') {
            toastr.error('Vui lòng điển đủ thông tin');
            return false;
        }

        var form_data = form.serializeObject();

        $.ajax({
            type: 'POST',
            url: '/api/employee/save',
            headers: {
                'Accept': 'application/json',
                'Content-Type': 'application/json'
            },
            data : JSON.stringify(form_data),
            dataType: 'json',
            beforeSend: function () {},
            success: function (data) {
                console.log(data);
                debugger;
            },
        });

    }

    function getEmloyee(page = 1) {
        var target = $('#data_table');
        $.ajax({
            type: 'GET',
            url: '/api/employee/list',
            data: {page: page},
            beforeSend: function () {
                tagetWaitMe(target);
            },
            success: function (data) {
                generateTable(data.content);
                showPaginate(data.totalPages, data.number + 1);
            },
            complete: function () {
                target.waitMe('hide');
            }
        });
    }

    function getAllJob() {
        $.ajax({
            type: 'GET',
            url: '/api/job/list',
            beforeSend: function () {
            },
            success: function (data) {
                generateSelect(data);
            },
            complete: function () {
            }
        });
    }

    function generateSelect(data) {
        var html = '<option value="" selected="">Chọn chức vụ</option>';
        $.each(data, function (key, value) {
            html += '<option value="' + value.id + '">' + value.name + '</option>';
        });
        $('#job_select_content').html(html);
        $('#show_job').html(html);
    }

    function deleteEmloyee(id) {
        var target = $('#data_table');
        if (!confirm("Bạn có muốn xóa nhân viên này không")) {
            return;
        }
        $.ajax({
            type: 'DELETE',
            url: '/api/employee/' + id,
            beforeSend: function () {
            },
            statusCode: {
                400: function (xhr) {
                    toastr.error("Không xóa được");
                }
            },
            success: function (data, textStatus, xhr) {
                if (xhr.status === 200) {
                    toastr.success("Đã xóa");
                    getEmloyee();
                }
            }
        });
    }

    function generateTable(data) {
        $('#show_data').html('');
        var html = '';
        $.each(data, function (key, value) {
            html = '<tr>';
            html += '<td>' + value.empId + '</td>';
            html += '<td>' + value.empName + '</td>';
            html += '<td>' + value.jobName + '</td>';
            html += '<td>' + value.empPhone + '</td>';
            html += '<td>' + value.empAddress + '</td>';
            html += '<td><button onclick="deleteEmloyee(' + value.empId + ')" class="btn btn-action label label-danger"><i class="fa fa-trash"></i></button></td>';
            html += '</tr>';
            $('#show_data').append(html);
        })
    }

    //hàm phân trang bằng js
    function showPaginate(lastPage, currentPage) {
        let counter;
        var adjacents = 2;
        var next = currentPage + 1;
        var previous = currentPage - 1;
        var pagination = '';

        if (lastPage > 6) {
            pagination += "<ul class='pagination pull-right'>";
            if (currentPage > 1) {
                pagination += "<li class='page-item'><a class='page-link current' title='Về trang đầu' onclick='getEmloyee()' href='javascript: void(0)'><i class='fa fa-fw fa-angle-double-left' aria-hidden='true'></i></a></li>";
                pagination += "<li class='page-item'><a class='page-link' title='previous' onclick='getEmloyee(" + previous + ")' href='javascript: void(0)'><i class='fa fa-fw fa-angle-left' aria-hidden='true'></i></a></li>";
            }
            if (lastPage < 3 + (adjacents * 2)) {
                for (counter = 1; counter <= lastPage; counter++) {
                    pagination += (counter === currentPage)
                        ? "<li class='active page-item'><a class='page-link'>" + counter + "</a></li>"
                        : "<li class='page-item'><a class='page-link' onclick='getEmloyee(" + counter + ")' href='javascript: void(0)'>" + counter + "</a></li>";
                }
            } else if (lastPage > 3 + (adjacents * 2)) {
                // trường hợp dành cho việc phân trang lúc đầu nhỏ hơn 5
                if (currentPage < 1 + (adjacents * 2)) {
                    for (counter = 1; counter < 2 + (adjacents * 2); counter++) {
                        pagination += (counter === currentPage)
                            ? "<li class='active page-item'><a class='page-link'>" + counter + "</a></li>"
                            : "<li class='page-item'><a class='page-link' onclick='getEmloyee(" + counter + ")' href='javascript: void(0)'>" + counter + "</a></li>";
                    }
                } //trường hợp dành cho page cuối cùng -4 lớn hơn page đang ở
                else if (lastPage - (adjacents * 2) > currentPage && currentPage > (adjacents * 2)) {

                    for (counter = currentPage - adjacents; counter <= currentPage + adjacents; counter++) {
                        pagination += (counter === currentPage)
                            ? "<li class='active page-item'><a class='page-link'>" + counter + "</a></li>"
                            : "<li class='page-item'><a class='page-link' onclick='getEmloyee(" + counter + ")' href='javascript: void(0)'>" + counter + "</a></li>";
                    }
                } // trường hợp click vào các page cuối cùng
                else {
                    for (counter = lastPage - (2 + (adjacents * 2)); counter <= lastPage; counter++) {
                        pagination += (counter === currentPage)
                            ? "<li class='active page-item'><a class='page-link'>" + counter + "</a></li>"
                            : "<li class='page-item'><a class='page-link' onclick='getEmloyee(" + counter + ")' href='javascript: void(0)'>" + counter + "</a></li>";
                    }
                }
            }
            if (currentPage < lastPage - 2) {
                pagination += "<li class='page-item'><a class='page-link' title='next' onclick='getEmloyee(" + next + ")' href='javascript: void(0)'><i class='fa fa-fw fa-angle-right' aria-hidden='true'></i></a></li>";
                pagination += "<li class='page-item'><a class='page-link' title='Về trang cuối' onclick='getEmloyee(" + lastPage + ")' href='javascript: void(0)'><i class='fa fa-fw fa-angle-double-right' aria-hidden='true'></i></a></li>";
            }
            pagination += "</ul>";
        } else if (lastPage > 1) {
            pagination += "<ul class='pagination'>";
            for (counter = 1; counter <= lastPage; counter++) {
                pagination += (counter === currentPage)
                    ? "<li class='active page-item'><a class='page-link'>" + counter + "</a></li>"
                    : "<li class='page-item'><a class='page-link' onclick='getEmloyee(" + counter + ")' href='javascript: void(0)'>" + counter + "</a></li>";
            }
        } else {
            pagination = '';
        }
        $('#paginate_div').html(pagination);

        // console.log('lastPage: ' + lastPage, 'currentPage: ' + currentPage, 'adjacents: ' + adjacents, 'next: ' + next, 'previous: ' + previous);
    }

    function tagetWaitMe(taget) {
        taget.waitMe({
            effect: 'rotation',
            text: 'loading...',
            waitTime: -1,
        });
    }
</script>
</body>
</html>
